    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Make Reservation - Client | MVRMS</title>
        <link rel="stylesheet" href="/MVRMS/client/css/client.css">
        <link rel="icon" type="image/png" href="/MVRMS/client/images/logo.png">
    </head>
    <body>

    <div class="dashboard-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="/MVRMS/client/images/logo.png" class="sidebar-logo">
                <h2>MVRMS</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="/MVRMS/client/pages/client/dashboard.html" class="nav-item">Dashboard</a>
                <a href="/MVRMS/client/pages/client/browse-vehicles.html" class="nav-item">Browse Vehicles</a>
                <a href="/MVRMS/client/pages/client/make-reservation.html" class="nav-item active">Make Reservation</a>
                <a href="/MVRMS/client/pages/client/my-bookings.html" class="nav-item">My Bookings</a>
                <a href="/MVRMS/client/pages/client/rental-history.html" class="nav-item">Rental History</a>
                <a href="/MVRMS/client/pages/client/handle-payment.html" class="nav-item">Payments</a>
                <a href="/MVRMS/client/pages/client/profile.html" class="nav-item">Profile</a>
                <a href="../login.html" class="nav-item logout">Logout</a>
            </nav>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <div class="search-bar">
                    <input type="text" placeholder="Search...">
                </div>
                <div class="user-info">
                    <span id="currentUsername">Client</span>
                </div>
            </header>

            <div class="page-content">
                <h1>Make a Reservation</h1>

                <form id="reservationForm" class="reservation-form">

                    <div class="form-group">
                        <label>Select Vehicle</label>
                        <select id="vehicleSelect" required>
                            <option value="">-- Select Vehicle --</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Pickup Date</label>
                            <input type="date" id="pickupDate" required>
                        </div>
                        <div class="form-group">
                            <label>Return Date</label>
                            <input type="date" id="returnDate" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Pickup Location</label>
                            <input type="text" id="pickupLocation" required>
                        </div>
                        <div class="form-group">
                            <label>Drop-off Location</label>
                            <input type="text" id="dropoffLocation" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="notes"></textarea>
                    </div>

                    <div class="cost-summary">
                        <p>Daily Rate: <span id="dailyRate">₱0</span></p>
                        <p>Number of Days: <span id="numberOfDays">0</span></p>
                        <p class="total">Total Cost: <span id="totalCost">₱0</span></p>
                    </div>

                    <button type="submit" class="btn-primary">Confirm Reservation</button>
                </form>
            </div>
        </main>
    </div>

    
<script>
        const urlParams = new URLSearchParams(window.location.search);
        const selectedVehicleId = urlParams.get("vehicle_id");

        console.log("Selected vehicle ID:", selectedVehicleId);

        /* ================= AUTH CHECK ================= */
        function checkAuth() {
            const currentUser = JSON.parse(localStorage.getItem("currentUser"));
            if (!currentUser || !currentUser.user_id) {
                alert("Please login again.");
                window.location.href = "/MVRMS/client/pages/login.html";
                return null;
            }
            return currentUser;
        }

        /* ================= LOAD VEHICLES ================= */
        function loadVehicles() {
            const urlParams = new URLSearchParams(window.location.search);
            const selectedVehicleId = urlParams.get("vehicle_id");

            fetch("/MVRMS/api/get-available-vehicles.php")
                .then(res => res.text())
                .then(text => {
                    if (!text) return [];
                    return JSON.parse(text);
                })
                .then(data => {
                    const select = document.getElementById("vehicleSelect");
                    select.innerHTML = `<option value="">-- Select Vehicle --</option>`;

                    data.forEach(v => {
                        const opt = document.createElement("option");
                        opt.value = v.vehicle_id;
                        opt.dataset.rate = v.daily_rate;
                        opt.textContent = `${v.vehicle_name} (₱${v.daily_rate}/day)`;

                        if (selectedVehicleId && v.vehicle_id == selectedVehicleId) {
                            opt.selected = true;
                        }

                        select.appendChild(opt);
                    });

                    calculateCost();
                })
                .catch(err => console.error("Load vehicles error:", err));
        }
        
        /* ================= COST CALCULATION ================= */
        function calculateCost() {
            const select = document.getElementById("vehicleSelect");
            if (!select.value) return;

            const rate = Number(select.selectedOptions[0].dataset.rate || 0);
            const pickup = document.getElementById("pickupDate").value;
            const dropoff = document.getElementById("returnDate").value;
            if (!pickup || !dropoff) return;

            const start = new Date(pickup);
            const end = new Date(dropoff);
            if (end <= start) return;

            const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
            const total = days * rate;

            document.getElementById("dailyRate").textContent = `₱${rate}`;
            document.getElementById("numberOfDays").textContent = days;
            document.getElementById("totalCost").textContent = `₱${total.toLocaleString()}`;
        }

        /* ================= SUBMIT RESERVATION ================= */
        document.getElementById("reservationForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const currentUser = checkAuth();
            if (!currentUser) return;

            const vehicleSelect = document.getElementById("vehicleSelect");

            const payload = {
                user_id: currentUser.user_id,
                vehicle_id: vehicleSelect.value,
                pickup_date: pickupDate.value,
                return_date: returnDate.value,
                pickup_location: pickupLocation.value,
                dropoff_location: dropoffLocation.value,
                notes: additionalNotes.value
            };

            fetch("/MVRMS/api/create-reservation.php", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === "success") {
                    alert("Reservation successful!");
                    window.location.href = "/MVRMS/client/pages/client/browse-vehicles.html";
                } else {
                    alert(data.message);
                }
            })
            .catch(err => {
                console.error(err);
                alert("Server error");
            });
        });

        /* ================= EVENTS ================= */
        vehicleSelect.addEventListener("change", calculateCost);
        pickupDate.addEventListener("change", calculateCost);
        returnDate.addEventListener("change", calculateCost);

        document.addEventListener("DOMContentLoaded", () => {
            checkAuth();
            loadVehicles();
        });
</script>

</body>
</html>
